%!TEX root = ../template.tex
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% chapter2.tex
%% NOVA thesis document file
%%
%% Chapter with the template manual
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\typeout{NT FILE demmon.tex}

\chapter{DeMMON}
\label{cha:demmon}

DeMMon (Decentralized Management and Monitoring Overlay Network) is an overlay network aiming to create logical connections among nodes integrating the network, forming multiple tree-shaped networks. Then, it provides an API to request information about nodes and services running in the system, which is collected on-demand by the monitoring protocol via efficient information aggregation and dissemination using the tree structure.

In this chapter, we will begin by explaining the targeted environment and the operation of the overlay network, whose tree shape is the basis for the aggregation protocol. After, detail how the aggregation protocol performs aggregations in the tree, and lastly, list the operations exposed by the API and discuss how it interacts with the remaining components. \todo{insert refs to subsections ahead}

This solution, as observable in figure \ref{fig:demmon-overview}, is composed of three major components:

\begin{figure}[htbp]
    \centering
    \includegraphics[width=\textwidth]{Chapters/Figures/DeMMon-arch-overview.pdf}
    \caption{An overview of the architecture of DeMMon}
    \label{fig:demmon-overview}
\end{figure}


\begin{enumerate}
    \item The overlay network, which strives to build the tree-shaped network, nodes in this network use proximity and a set of logical rules to change their location in the tree.

    \item The monitoring protocol, which is a component that collects and disseminates information using the overlay network's established connections. It communicates via notifications and asynchronous request-replies with the overlay network to receive updates regarding established connections and connection failures. Lastly, it receives requests from the API to collect information.

    \item Lastly, the API receives updates from both the overlay network and the monitoring protocol, exposes the received information from those layers, and allows ingestion of new information. Furthermore, it allows issuing commands to collect new information, perform local aggregations periodically, or trigger issued alarms based on the respective conditions.
\end{enumerate}

\section{Overlay network}

In this section, we discuss the design of the overlay network, which aims to build and maintain a latency and bandwidth aware tree-shaped network. We begin by providing the considered system model, then follow with an overview of the mechanisms responsible for building and maintaining the tree. Lastly, we conclude the chapter with a summary and discussion of the protocol.

\subsection{System Model}

The assumed system model is a distributed scenario composed of nodes connected to the internet set-up such that they can send and receive messages via the internet (i.e. with an external IP or port-forwarding). All nodes are running the GO-Babel framework with the same configuration settings, and that each node knows a priori a set of nodes to join the network (also denoted by landmarks). Optionally, the protocol can employ bandwidths to impose additional constraints in the tree-building procedures, so nodes with higher bandwidths tend to be used at the top of the tree topology. In this case, the system administrator must also configure nodes with a heuristic of their bandwidth capacity. Lastly, every node must share the same configurations concerning the membership protocols' parameters, listed in the following subsection.  \todo {say nodes are bandwidth-constrained}

\subsection{Tree construction and maintenance}

The devised membership protocol is coalesced by five main mechanisms: (1) the \textbf{join} mechanism, which aims to establish the initial tree structure, (2) \textbf{active view maintenance} is the mechanism responsible for periodically sharing some state with peers, which later useful for tree optimizations, (3) \textbf{group optimization}, where nodes periodically attempt to optimize their childrens' active connections, (4) \textbf{passive view maintenance}, responsible for collecting information about peers which are not in the active view, used for fault tolerance and optimizations, and finally, (5) \textbf{oportunistic optimization}, where nodes may attempt to improve their position in the overlay based on latency and bandwidth. We will now cover each mechanism in the provided order.

As previously mentioned, the join mechanism is the mechanism responsible for creating the initial tree structure, it is the first mechanism to be executed by each node in the system, 

\input{Chapters/pseudocode/memb_join.tex}

\subsection{Summary}

\section{Monitoring protocol}

\subsection{Overview}

\subsection{Aggregation mechanisms}

\subsubsection{Single root aggregation}

\subsubsection{Multi root aggregation}

\subsubsection{Neighborhood aggregation}

\subsection{Summary}

\section{API}

\subsection{System Model}

\subsection{Overview}

\subsection{Showcase}
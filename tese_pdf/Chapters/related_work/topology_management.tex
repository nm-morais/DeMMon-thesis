
% -------------------
% Topology Management
% -------------------

As previously mentioned, a challenge towards solving the proposed solution is to federate all peers in an abstraction layer that allows intercommunication and efficient resource discovery. Given that this is a classic P2P problem, this section provides context about P2P systems and the taxonomy of overlay networks.

In P2P, participants contribute to the system with a portion of their resources,so that that the overall system can accomplish tasks which would otherwise be impossible for a single peer to solve. However, due to memory and communication overhead, it is undesirable that all nodes in a P2P system collaborate with all other peers (unless in specific scenarios which we will further elaborate). 

Instead, peers select a subset of peers in the system to establish neighboring relations. These neighboring relations are usually constructed on top underlying links from an already existing network (called an underlay). Intuitively, the accumulation of neighboring relations on top of the underlay network is what constitutes the \textbf{overlay network}. 

\subsection{Evaluating topologies}

If we look at neighboring connections as edges in a graph, we can define a set of metrics to measure graph-related metrics to measure overlay performance:

\begin{enumerate}
    
    \item \textbf{Connectivity}. A connected graph is one where there is at least one path from each node to all other nodes in the system. The absence of this property means that there are nodes in the system that are isolated, thus will not be able to cooperate towards the overall behavior of the system. This property is usually measured as a percentage, corresponding to the largest portion of the system that is connected. Intuitively, a  connected overlay has 100\% connectivity.
    
    \item \textbf{Degree Distribution}. The degree of a node consists in the number of arcs that are connected to it. Depending on the type of system, the connections may be directed or indirected, in a directed graph there is a distinction between \textbf{in-degree} and \textbf{out-degree} of a node. Intuitively, nodes with a high in-degree have higher reachability in the system, and nodes with 0 in-degree cannot be reached. In flat overlays, where load distribution is desired, degree distribution should be as similar as possible in all nodes. By contrast, in hierarchical overlays,  designs take advantage of device heterogeneity to differentiate between peers and promote scalability.
    
    \item \textbf{Average Shortest Path}. A path is composed by the edges of the graph that a message would have to cross to get from one node to other. The average shortest path consists in the average of all those paths, to promote efficient communication patterns, is desirable that this value is as low as possible.
    
    \item \textbf{Clustering Coefficient}. The clustering coefficient provides a measure of the density of neighboring relations across the neighbors of a given node. It consists in the number of a node's neighbors divided by the maximum number of links between those neighbors. Similar to the average shortest path, the clustering coefficient of an overlay consists in the average of the clustering coefficient of all the peers. A high value of clustering coefficients will result in a higher number of redundant messages, and by consequence, additional localized traffic. Finally, areas of an overlay with a higher clustering coefficient tend to be more easily isolated from the remaining system.
    
    \item \textbf{Overlay Cost}. If we assume that a link in the overlay has a \textit{cost}, then the overlay cost is the sum of all the links that form the overlay. Link cost can derive from overlay metrics (numeric distance, XOR distance, etc), or external metrics such as latency.
    
\end{enumerate}

\subsection{Taxonomy of overlay networks}

There are two main approaches to build decentralized P2P systems, which are split in two categories: structured and unstructured. Within those categories we have identified the following sub-categories: flat and hierarchical. 

\subsection{Unstructured Overlays}

\textbf{Unstructured overlays} usually impose little to no rules in neighboring relations, peers may pick random peers to be their neighbors, or alternatively employ strategies to "rank" neighbors and selectively pick the "best".

A key factor of unstructured overlays is their low maintenance cost, given that nodes can easily create neighboring relations and replace failed ones. Consequently, this is the type of overlay which offers better resilience to churn \cite{stutzbach2006understanding} (participants concurrently entering and leaving the system).

\subsubsection{Flat unstructured Overlays}

A flat unstructured overlay is an overlay where peers contribute evenly towards a common system goal. These overlays attempt to have even degree distributions while providing good connectivity. A prime example of a flat unstructured overlay which is highly resilient to churn and catastrophic failures is \textit{Hyparview} \cite{Hyparview}. 

\textit{Hyparview} (Hybrid Partial View) gets its name from maintaining two exclusive views: the \textit{active} and \textit{passive} view, that are distinguished by their maintenance strategy. 

The \textit{passive view} is a larger view which consists of a random set of peers in the system, this view is maintained by a simple gossip protocol which periodically gossips a message to a random peer in the active view. This message contains a subset of the neighbors of the sending node and a time-to-live (TTL), the message is forwarded in the system until the TTL expires. In contrast, the \textit{active view} is a smaller view (around log(n) ) created during the bootstrap of the protocol, and actively maintained by monitoring peers with a TCP connection (effectively making the active view connections bidirectional and act as a failure detector). Whenever peers from the active view fail, nodes attempt to replace them with nodes in the passive view.

Hyparview achieves high reliability even in the face of high percentage of high node failures (up to 80-90\% of all nodes). This is highly desirable in edge environments. However, due to battery constraints, many devices cannot actively maintain TCP connections, which limits the applicability of Hyparview towards levels 0-4 of the taxonomy described in \ref{subsec:edge_taxonomy}. Hyparview is often used as a \textit{peer sampling service} for other protocols which rely on the connections from the active view to collaborate  (e.g. PlumTree \cite{leitao2007epidemic} and X-BOT \cite{leitao2012x}).

\textit{T-MAN} \cite{jelasity2005t} is protocol based on a gossiping scheme, which proposes to build a wide range of overlay networks from scratch (e.g. ring, mesh, tree, etc.). To achieve this, T-MAN takes an overlay as an input to the protocol, this overlay is represented by \textit{ranking method}. The ranking method sorts a set of nodes according to a given metric, where first nodes are the most "preferable" of the list. The resulting protocol is scalable and fast, with convergence times that grow as the logarithm of the network size. Furthermore, it is completely decentralized and extremely robust. Limitations that arise from using T-Man is that it does not ensure stability of in-degree of nodes during the optimization of the overlay.

\textit{X-BOT} \cite{leitao2012x} X-BOT is a protocol which constructs an unstructured overlay network where neighboring relations are biased towards a certain metric. X-BOT does so while preserving key properties of the overlay such as the node degree and consequently, the overlay connectivity.

Neighboring connections are attributed a metric according to an \textit{oracle},which consists in a component which exports a function that takes a pair of peers in the system and attributes a cost to that neighboring connection. An oracle may take into account device latency, ISP distribution, stretch, among others. 

The rationale X-BOT is as follows, nodes maintain active and passive views similar to Hyparview \cite{Hyparview}. Then, nodes periodically trigger optimization rounds where nodes attempt to swap one neighbor from their active active view with another neighbor which ranks higher according to the oracle. 

An important factor (which contrasts with \cite{jelasity2005t}) is that nodes in the system maintain unbiased neighbors such that the overlay maintains low average path length and low clustering coefficient.

\subsubsection{Unstructured Hierarchical Overlays}

Unstructured hierarchical overlays are characterized as overlays where peers have different tasks in the system, which easily accommodates device heterogeneity while potentially increasing the performance of the system. 

An example is \textbf{super-peers}, which are peers that have increased capacity and stability, that are commonly assigned towards disseminating queries throughout the system or caching file locations.

\textcolor{red}{ should i do trees here?}

Super-peers have proven their effectiveness in reducing the number of peers that have to exchange messages, which by consequence raises system scalability. This is the approach taken by Gia \cite{Chawathe2003} to improve the scalability of Gnutella \cite{gnutella_gtk}. However, this approach is inefficient when finding rare resources in the system.

\textbf{Overnesia} \cite{leitao2014overnesia} is a protocol which creates virtual super-peers by maintaining fully connected groups of nodes with the same identifier known by all elements in the group. Nodes join the system by sending a JOIN request to a bootstrap node which triggers a random walk, the requesting node joins the group where random walk finishes (either because it finds an underpopulated group or because the TTL expires). 

Then, in order to promote intra-group membership consistency, nodes employ an anti-entropy mechanism where they periodically exchange messages containing their own view of the group. 

When a group detects that its size has become too large, it triggers a dividing procedure which splits the groups in two halves. This division reduces the costs of replicating data among its members, but also promotes good load-balancing of the system. 

When group size has fallen bellow a certain threshold, Overnesia triggers a collapse procedure, where each node takes the initiative to relocate itself to another group, resulting in the collapse of the group. 

Finally, nodes perform walks along the overlay in order to establish inter-group links which in turn use to perform efficient broadcasts.

\subsection{Structured overlays} 

\textbf{Structured overlays} enforce stronger rules towards neighbor selection (generally based on identifiers of peers). As a result, the overlay generally converges to a topology known a priori, where the target topologies are tailored towards applicational requirements. 

A canonical example of a structured overlay is a distributed hash table (DHT)DHTs offer efficient routing capabilities over the identifier space (usually routing procedures take a logarithmic number of steps), DHTs have been extensibly used to support many large scale services (publish-subscribe, file sharing, among others) and are especially used in Cloud-based environments. 

\subsubsection{Flat structured overlays}

In a flat DHT, peers use consistent hashing functions to select random identifiers which are uniformly distributed over the identifier space. We will cover distributed hash tables with a bigger emphasis in section \ref{sec:res_location}

\subsubsection{Hierarchical structured overlays}

The second approach to building a hierarchical topology is to employ a DHT, hierarchical DHTS usually form contained DHTS within other DHTS (e.g. a ring within a ring). This offers several important advantages over a flat DHT: first, lookups take less hops and messages to reach the target, second, organizing nodes in disjoint groups allows traffic locality if groups of nodes are close in the underlay, finally, churn events within a group stay contained within that group. However, many of these systems either employ more memory to accommodate the many levels hierarchical DHT, or tradeoff reliability (by shortening the number of connections) for memory and communication efficiency.

\subsection{Discussion}

Unstructured overlays are an attractive option to federate large amounts of devices in heavily dynamic environments. They provide a low clustering coefficient and good connectivity even in the face of churn, which makes them appealing towards the edge environments. 

Conversely, structured overlays enable efficient routing procedures with very low message overhead, which makes them suitable for resource location systems. However, given the strict neighboring rules, nodes cannot replace neighbors easily, which hinders the fault-tolerance of these types of topologies.